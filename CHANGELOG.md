# Changelog

本项目变更记录遵循以下约定：

- 参考 Keep a Changelog 结构
- 版本号遵循 Semantic Versioning（SemVer）
- 每次更新优先记录到 `Unreleased`，发布时再归档到具体版本

## [Unreleased]

### Added

- 顶部工具栏新增模型选择器，支持显示当前模型、展开模型列表、点击切换模型。
- 新增 ACP 模型元数据事件同步：后端解析 `session/new` / `session/load` 返回的 `_meta.models` 并推送到前端。
- 对话区新增快捷交互按钮：
  - 助手最后一条消息下显示“继续 / 好的 / 重试上一问”；
  - 用户最后一条消息下显示“重试发送”。
- 消息内容新增基础 Markdown 渲染能力，支持标题、列表、引用、行内代码、代码块、链接与图片展示。
- 新增 HTML Artifact 预览能力：
  - 自动从消息/工具输出中识别 `.html/.htm` 路径并显示“预览 HTML”按钮；
  - 点击后通过弹窗内 `iframe` 直接预览生成的 HTML 文件。

### Changed

- 模型切换链路改为“ACP 优先 + 重启兜底”：
  - 优先调用 `session/set_model`，减少切换中断；
  - ACP 不可用时自动回退到重启进程并通过 `--model` 切换。
- 模型列表获取兼容增强：后端支持从 `iflow.js` / `entry.js` 解析模型常量。
- 工具调用面板改为按 `toolCallId` 增量合并，不再每条事件全量覆盖。
- 输入区发送态交互调整为“发送按钮切换停止按钮”：
  - 回复进行中可点击停止，不必等待自然返回；
  - 前端点击后立即结束等待动画，并异步发送 ACP `session/cancel` 请求。
- 新增后端受限文件读取命令 `read_html_artifact`：
  - 仅允许读取当前 Agent 工作目录内的 `.html/.htm` 文件；
  - 增加路径越界校验与文件大小限制，避免任意文件读取。
- HTML Artifact 预览性能优化：
  - 预热预览容器，降低首次打开卡顿感；
  - 引入基于 `Agent + 文件路径` 的内存缓存，重复打开同一文件更快；
  - 关闭预览时保留已渲染内容，减少重复解析成本。
  - 后端 HTML 读取链路改为 `tokio::fs` 异步 I/O，降低阻塞风险。

### Fixed

- 修复工具调用在状态变为 `completed` 后内容闪烁/丢失的问题（例如 `web_search` 查询内容被覆盖）。
- 修复工具调用面板只能显示最后一条的问题，改为支持同一轮显示多条调用记录。
- 修复输入 `/` 后使用键盘上下键移动时，命令列表未自动滚动到高亮项的问题。
- 修复 Markdown 管道表格（`| a | b |`）未渲染的问题，现已支持表格展示与横向滚动。
- 修复 Markdown 分割线（`---`）后标题与分割线间距过小的问题，提升可读性。

## [0.1.0] - 2026-02-25

### Added

- 初始版本：Tauri + TypeScript 的 iFlow Workspace 基础能力。
