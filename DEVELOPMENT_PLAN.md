# ACP GUI å®¢æˆ·ç«¯ - å¼€å‘éœ€æ±‚ä¸è®¡åˆ’

## é¡¹ç›®æ¦‚è¿°

åŸºäº ACP (Agent Communication Protocol) çš„ GUI å®¢æˆ·ç«¯ï¼Œç”¨äºè¿æ¥å’Œç®¡ç†å¤šä¸ª AI Agentï¼Œæä¾›å¯è§†åŒ–çš„å¯¹è¯ç•Œé¢å’Œå·¥å…·è°ƒç”¨å±•ç¤ºã€‚

**æŠ€æœ¯æ ˆ**: Tauri (Rust) + TypeScript + Vite

---

## å·²å®Œæˆçš„å·¥ä½œ âœ…

### 1. é¡¹ç›®è°ƒç ”
- [x] åˆ†æäº† OpenWorkã€Mossxã€Codexia ç­‰å‚è€ƒé¡¹ç›®
- [x] ç ”ç©¶äº† ACP åè®®è§„èŒƒå’Œé€šä¿¡æœºåˆ¶
- [x] ç¡®å®šäº†å¤š Agent æ¶æ„çš„å¯è¡Œæ€§

### 2. æŠ€æœ¯é€‰å‹
- [x] é€‰æ‹©äº† Tauri + TypeScript + Vite æ¶æ„
- [x] ç¡®å®šäº† WebSocket ä½œä¸º ACP é€šä¿¡åè®®
- [x] é€‰æ‹©äº†è½»é‡çº§å‰ç«¯æ–¹æ¡ˆï¼ˆåŸç”Ÿ TSï¼Œæ— æ¡†æ¶ï¼‰

### 3. é¡¹ç›®åˆå§‹åŒ–
- [x] åˆ›å»ºäº† Tauri é¡¹ç›®æ¡†æ¶
- [x] é…ç½®äº†å¼€å‘ç¯å¢ƒï¼ˆRustã€Node.jsï¼‰
- [x] è®¾ç½®äº†é¡¹ç›®ç»“æ„å’Œæ„å»ºæµç¨‹

### 4. ACP åè®®æ¨¡å—
- [x] å®ç°äº† WebSocket è¿æ¥ç®¡ç† (`AcpConnection`)
- [x] å®ç°äº†æ¶ˆæ¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–
- [x] æ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼š
  - `user_message` - ç”¨æˆ·æ¶ˆæ¯
  - `agent_message_chunk` - Agent æµå¼å“åº”
  - `agent_thought_chunk` - Agent æ€è€ƒè¿‡ç¨‹
  - `tool_call` / `tool_call_update` - å·¥å…·è°ƒç”¨
  - `plan` - æ‰§è¡Œè®¡åˆ’
  - `stop_reason` / `task_finish` - ä»»åŠ¡å®Œæˆ

### 5. åŸºç¡€ UI å®ç°
- [x] åˆ›å»ºäº†å¯¹è¯ç•Œé¢å¸ƒå±€
- [x] å®ç°äº† Agent åˆ—è¡¨ä¾§è¾¹æ 
- [x] å®ç°äº†æ¶ˆæ¯å±•ç¤ºåŒºåŸŸï¼ˆæ”¯æŒæµå¼è¾“å‡ºï¼‰
- [x] å®ç°äº†è¾“å…¥æ¡†å’Œå‘é€åŠŸèƒ½
- [x] æ·»åŠ äº†å·¥å…·è°ƒç”¨é¢æ¿
- [x] å®ç°äº†æ·»åŠ  Agent çš„å¼¹çª—

### 6. Rust åç«¯åŠŸèƒ½
- [x] `connect_iflow` - è¿æ¥ iFlow Agent
- [x] `send_message` - å‘é€æ¶ˆæ¯å¹¶å¯åŠ¨åå°ç›‘å¬
- [x] `stop_receiving` - åœæ­¢æ¥æ”¶æ¶ˆæ¯
- [x] `get_messages` - è·å–æ¶ˆæ¯å†å²
- [x] `disconnect_agent` - æ–­å¼€ Agent è¿æ¥
- [x] å®ç°äº†ç«¯å£è‡ªåŠ¨åˆ†é…ï¼ˆæŸ¥æ‰¾å¯ç”¨ç«¯å£ï¼‰
- [x] å®ç°äº†è¿›ç¨‹ç®¡ç†å’Œæ¸…ç†

### 7. å‰ç«¯åŠŸèƒ½
- [x] Agent çš„æ·»åŠ ã€åˆ é™¤ã€é€‰æ‹©
- [x] æ¶ˆæ¯çš„å®æ—¶æµå¼æ˜¾ç¤º
- [x] å·¥å…·è°ƒç”¨çš„å±•ç¤º
- [x] æœ¬åœ°å­˜å‚¨ï¼ˆAgent åˆ—è¡¨æŒä¹…åŒ–ï¼‰
- [x] è¿æ¥çŠ¶æ€ç®¡ç†

### 8. ç¯å¢ƒä¿®å¤
- [x] è§£å†³äº† Rust ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
- [x] ä¿®å¤äº†ç¼–è¯‘é”™è¯¯
- [x] æ·»åŠ äº†å¿…è¦çš„å›¾æ ‡æ–‡ä»¶
- [x] é…ç½®äº† Tauri 2.0 ç¯å¢ƒ

---

## å‰©ä½™è®¡åˆ’ ğŸ“‹

### Phase 1: æ ¸å¿ƒåŠŸèƒ½å¢å¼º

#### 1.1 å¤š Agent æ”¯æŒ ğŸ”¥
**ä¼˜å…ˆçº§**: é«˜
**æè¿°**: ç›®å‰åªæ”¯æŒ iFlowï¼Œéœ€è¦æ‰©å±•åˆ°å…¶ä»– Agent

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] è®¾è®¡ç»Ÿä¸€çš„ Agent æ¥å£æŠ½è±¡
- [ ] æ”¯æŒ Claude Code é›†æˆ
  - [ ] ç ”ç©¶ Claude Code çš„ MCP/ACP åè®®
  - [ ] å®ç° `connect_claude` å‘½ä»¤
  - [ ] é€‚é… Claude çš„æ¶ˆæ¯æ ¼å¼
- [ ] æ”¯æŒ Codex (OpenAI) é›†æˆ
  - [ ] ç ”ç©¶ Codex CLI çš„é€šä¿¡åè®®
  - [ ] å®ç° `connect_codex` å‘½ä»¤
- [ ] æ”¯æŒè‡ªå®šä¹‰ Agent é…ç½®
- [ ] æ·»åŠ  Agent ç±»å‹å›¾æ ‡åŒºåˆ†

**æŠ€æœ¯è¦ç‚¹**:
```rust
// è®¾è®¡ç»Ÿä¸€çš„ Agent trait
pub trait Agent {
    async fn connect(&mut self) -> Result<(), String>;
    async fn send(&mut self, message: String) -> Result<(), String>;
    async fn receive(&mut self) -> Result<String, String>;
    async fn disconnect(&mut self) -> Result<(), String>;
}
```

#### 1.2 å¤šä¼šè¯æ ‡ç­¾é¡µ ğŸ”¥
**ä¼˜å…ˆçº§**: é«˜
**æè¿°**: æ”¯æŒå¤šä¸ªå¹¶è¡Œçš„å¯¹è¯ä¼šè¯

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] è®¾è®¡ä¼šè¯æ•°æ®æ¨¡å‹
- [ ] å®ç°æ ‡ç­¾é¡µ UI ç»„ä»¶
- [ ] å®ç°ä¼šè¯çš„åˆ›å»ºã€åˆ‡æ¢ã€å…³é—­
- [ ] ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆæ¯ä¸ªä¼šè¯ç‹¬ç«‹çš„æ¶ˆæ¯å†å²ï¼‰
- [ ] ä¼šè¯æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨
- [ ] ä¼šè¯é‡å‘½ååŠŸèƒ½

**UI è®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼šè¯ 1 â”‚ ä¼šè¯ 2 â”‚ ä¼šè¯ 3 â”‚ +        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚   å¯¹è¯å†…å®¹åŒºåŸŸ                       â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.3 å·¥å…·è°ƒç”¨å¯è§†åŒ–å¢å¼º
**ä¼˜å…ˆçº§**: ä¸­
**æè¿°**: æ›´å¥½çš„ Tool Call å±•ç¤ºå’Œäº¤äº’

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] è®¾è®¡å·¥å…·è°ƒç”¨å¡ç‰‡ç»„ä»¶
- [ ] æ”¯æŒå·¥å…·è°ƒç”¨çš„å±•å¼€/æŠ˜å 
- [ ] æ˜¾ç¤ºå·¥å…·è°ƒç”¨çš„æ‰§è¡Œæ—¶é—´
- [ ] æ”¯æŒå·¥å…·å‚æ•°çš„æ ¼å¼åŒ–å±•ç¤ºï¼ˆJSON é«˜äº®ï¼‰
- [ ] æ”¯æŒå·¥å…·æ‰§è¡Œç»“æœçš„æ ¼å¼åŒ–å±•ç¤º
- [ ] æ·»åŠ å·¥å…·è°ƒç”¨å†å²è®°å½•
- [ ] æ”¯æŒé‡æ–°æ‰§è¡Œå·¥å…·è°ƒç”¨

**UI æ”¹è¿›**:
- ä½¿ç”¨æ ‘å½¢ç»“æ„å±•ç¤ºåµŒå¥—å·¥å…·è°ƒç”¨
- æ·»åŠ å·¥å…·å›¾æ ‡å’Œé¢œè‰²æ ‡è¯†
- æ”¯æŒä»£ç é«˜äº®æ˜¾ç¤ºå‚æ•°å’Œç»“æœ

### Phase 2: æ–‡ä»¶ä¸å†å²ç®¡ç†

#### 2.1 æ–‡ä»¶æµè§ˆå™¨é›†æˆ
**ä¼˜å…ˆçº§**: ä¸­
**æè¿°**: é›†æˆæ–‡ä»¶ç³»ç»Ÿæµè§ˆåŠŸèƒ½

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] æ·»åŠ  Tauri FS æ’ä»¶æƒé™
- [ ] å®ç°æ–‡ä»¶æ ‘ç»„ä»¶
- [ ] æ”¯æŒæ–‡ä»¶/æ–‡ä»¶å¤¹çš„æµè§ˆ
- [ ] æ”¯æŒæ–‡ä»¶å†…å®¹é¢„è§ˆï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ï¼‰
- [ ] å®ç°æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ 
- [ ] æ”¯æŒåœ¨å¯¹è¯ä¸­å¼•ç”¨æ–‡ä»¶
- [ ] å®ç°æ–‡ä»¶æœç´¢åŠŸèƒ½

**åŠŸèƒ½ç»†èŠ‚**:
```typescript
interface FileNode {
  name: string;
  path: string;
  type: 'file' | 'directory';
  children?: FileNode[];
  size?: number;
  modified?: Date;
}
```

#### 2.2 ä¼šè¯å†å²æŒä¹…åŒ– ğŸ”¥
**ä¼˜å…ˆçº§**: é«˜
**æè¿°**: ä¿å­˜å’ŒåŠ è½½å†å²ä¼šè¯

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] è®¾è®¡ä¼šè¯å­˜å‚¨æ ¼å¼
- [ ] å®ç° SQLite æˆ–æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨
- [ ] è‡ªåŠ¨ä¿å­˜ä¼šè¯å†å²
- [ ] å®ç°å†å²ä¼šè¯åˆ—è¡¨
- [ ] æ”¯æŒæœç´¢å†å²ä¼šè¯
- [ ] æ”¯æŒå¯¼å‡ºä¼šè¯ä¸º Markdown/JSON
- [ ] æ”¯æŒå¯¼å…¥ä¼šè¯
- [ ] å®ç°ä¼šè¯å½’æ¡£åŠŸèƒ½

**å­˜å‚¨è®¾è®¡**:
```typescript
interface Session {
  id: string;
  title: string;
  agentId: string;
  createdAt: Date;
  updatedAt: Date;
  messages: Message[];
  metadata: {
    totalTokens?: number;
    toolCallCount?: number;
  };
}
```

### Phase 3: é«˜çº§åŠŸèƒ½

#### 3.1 Git å·¥ä½œæµé›†æˆ
**ä¼˜å…ˆçº§**: ä¸­
**æè¿°**: ç±»ä¼¼ Commander AI çš„ Git é›†æˆåŠŸèƒ½

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] é›†æˆ Git çŠ¶æ€æ£€æµ‹
- [ ] æ˜¾ç¤ºå½“å‰åˆ†æ”¯å’Œä¿®æ”¹æ–‡ä»¶
- [ ] æ”¯æŒç”Ÿæˆ Commit Message
- [ ] æ”¯æŒæŸ¥çœ‹ Diff
- [ ] å®ç°ä¸€é”®æäº¤åŠŸèƒ½
- [ ] æ”¯æŒåˆ›å»ºåˆ†æ”¯
- [ ] é›†æˆ PR/MR åˆ›å»º

**UI ç»„ä»¶**:
- Git çŠ¶æ€é¢æ¿ï¼ˆæ˜¾ç¤ºåˆ†æ”¯ã€ä¿®æ”¹æ–‡ä»¶æ•°ï¼‰
- Diff æŸ¥çœ‹å™¨
- Commit å¯¹è¯æ¡†

#### 3.2 æŠ€èƒ½ç³»ç»Ÿ
**ä¼˜å…ˆçº§**: ä½
**æè¿°**: ä¿å­˜å’Œå¤ç”¨å¸¸ç”¨å·¥ä½œæµ

**ä»»åŠ¡åˆ—è¡¨**:
- [ ] è®¾è®¡æŠ€èƒ½æ•°æ®æ¨¡å‹
- [ ] å®ç°æŠ€èƒ½åˆ›å»ºç•Œé¢
- [ ] æ”¯æŒå‚æ•°åŒ–æŠ€èƒ½æ¨¡æ¿
- [ ] å®ç°æŠ€èƒ½åº“ç®¡ç†
- [ ] æ”¯æŒæŠ€èƒ½åˆ†äº«/å¯¼å…¥
- [ ] å®ç°å¿«æ·å‘½ä»¤ï¼ˆå¦‚ `/refactor`, `/test`ï¼‰

**æŠ€èƒ½ç¤ºä¾‹**:
```yaml
skill:
  name: "ä»£ç é‡æ„"
  description: "åˆ†æå¹¶é‡æ„é€‰ä¸­çš„ä»£ç "
  prompt: "è¯·é‡æ„ä»¥ä¸‹ä»£ç ï¼Œæé«˜å¯è¯»æ€§å’Œæ€§èƒ½ï¼š\n\n{{code}}"
  parameters:
    - name: code
      type: string
      required: true
```

### Phase 4: ä¼˜åŒ–ä¸æ‰©å±•

#### 4.1 æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤„ç†é•¿å¯¹è¯ï¼‰
- [ ] ä¼˜åŒ–æ¶ˆæ¯æ¸²æŸ“æ€§èƒ½
- [ ] å®ç°å¢é‡ä¿å­˜
- [ ] ä¼˜åŒ–å†…å­˜ä½¿ç”¨

#### 4.2 è®¾ç½®ä¸é…ç½®
- [ ] å®ç°è®¾ç½®é¢æ¿
- [ ] æ”¯æŒä¸»é¢˜åˆ‡æ¢ï¼ˆæ·±è‰²/æµ…è‰²ï¼‰
- [ ] æ”¯æŒå¿«æ·é”®é…ç½®
- [ ] æ”¯æŒä»£ç†è®¾ç½®
- [ ] æ”¯æŒæ—¥å¿—çº§åˆ«é…ç½®

#### 4.3 æ‰“åŒ…ä¸å‘å¸ƒ
- [ ] é…ç½®åº”ç”¨ç­¾å
- [ ] å®ç°è‡ªåŠ¨æ›´æ–°
- [ ] åˆ›å»ºå®‰è£…ç¨‹åº
- [ ] ç¼–å†™ç”¨æˆ·æ–‡æ¡£

---

## æŠ€æœ¯å€ºåŠ¡ ğŸ”§

1. **é”™è¯¯å¤„ç†**: éœ€è¦ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·åé¦ˆ
2. **çŠ¶æ€ç®¡ç†**: å½“å‰çŠ¶æ€ç®¡ç†è¾ƒåˆ†æ•£ï¼Œè€ƒè™‘å¼•å…¥çŠ¶æ€ç®¡ç†åº“
3. **ç±»å‹å®‰å…¨**: å‰åç«¯ç±»å‹å®šä¹‰éœ€è¦åŒæ­¥ï¼Œè€ƒè™‘ä½¿ç”¨ç”Ÿæˆå·¥å…·
4. **æµ‹è¯•è¦†ç›–**: éœ€è¦æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
5. **æ—¥å¿—ç³»ç»Ÿ**: éœ€è¦å®Œå–„çš„æ—¥å¿—è®°å½•å’ŒæŸ¥çœ‹åŠŸèƒ½

---

## å½“å‰æ¶æ„

### åç«¯ (Rust)
```
src-tauri/src/
â””â”€â”€ main.rs
    â”œâ”€â”€ AcpConnection      # WebSocket è¿æ¥ç®¡ç†
    â”œâ”€â”€ AgentInstance      # Agent å®ä¾‹ç®¡ç†
    â”œâ”€â”€ AppState           # å…¨å±€çŠ¶æ€
    â”œâ”€â”€ Commands           # Tauri å‘½ä»¤
    â”‚   â”œâ”€â”€ connect_iflow
    â”‚   â”œâ”€â”€ send_message
    â”‚   â”œâ”€â”€ stop_receiving
    â”‚   â”œâ”€â”€ get_messages
    â”‚   â””â”€â”€ disconnect_agent
    â””â”€â”€ Types
        â”œâ”€â”€ AgentInfo
        â”œâ”€â”€ Message
        â””â”€â”€ ToolCall
```

### å‰ç«¯ (TypeScript)
```
src/
â”œâ”€â”€ main.ts              # ä¸»å…¥å£ï¼Œäº‹ä»¶å¤„ç†
â””â”€â”€ styles.css           # æ ·å¼

index.html               # ä¸»é¡µé¢
```

### æ•°æ®æµ
```
ç”¨æˆ·è¾“å…¥ â†’ UI â†’ Tauri Command â†’ Rust åç«¯ â†’ WebSocket â†’ iFlow
                                           â†“
æµå¼å“åº” â† UI â† Tauri Event â† Rust åç«¯ â† WebSocket
```

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨ ğŸ”œ

æ ¹æ®ä¼˜å…ˆçº§ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œï¼š

1. **ç«‹å³å¼€å§‹**: å¤šä¼šè¯æ ‡ç­¾é¡µï¼ˆé«˜ä¼˜å…ˆçº§ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼‰
2. **æœ¬å‘¨å†…**: ä¼šè¯å†å²æŒä¹…åŒ–ï¼ˆé«˜ä¼˜å…ˆçº§ï¼Œæ•°æ®å®‰å…¨ï¼‰
3. **ä¸‹å‘¨**: å¤š Agent æ”¯æŒï¼ˆæ‰©å±•æ€§ï¼‰
4. **åç»­**: å·¥å…·è°ƒç”¨å¯è§†åŒ–ã€æ–‡ä»¶æµè§ˆå™¨ã€Git é›†æˆç­‰

### åŸºäº CodexMonitor çš„æ¸è¿›æ¥å…¥æ–¹æ¡ˆï¼ˆ2026-02-24ï¼‰

#### CodexMonitor æŠ€æœ¯æ¦‚å†µ

| ç»´åº¦ | è¯¦æƒ… |
| --- | --- |
| æŠ€æœ¯æ ˆ | Tauri v2 (Rust) + React + TypeScript + Vite |
| åè®® | é€šè¿‡ stdio åŒå‘ JSON-RPC ä¸ `codex app-server` é€šä¿¡ï¼›è¿œç¨‹æ¨¡å¼ç”¨ TCP line-delimited JSON-RPC |
| å‰ç«¯æ¶æ„ | Feature-Slicedï¼ˆæŒ‰é¢†åŸŸ threads/composer/settings æ‹†ç›®å½•ï¼Œå„å« components + hooksï¼‰ |
| åç«¯æ¶æ„ | Shared Core æ¨¡å¼ï¼ˆé¢†åŸŸé€»è¾‘åœ¨ `shared/`ï¼Œapp å’Œ daemon éƒ½æ˜¯è–„é€‚é…å±‚ï¼‰ |
| çŠ¶æ€ç®¡ç† | ä¼šè¯çŠ¶æ€ç”¨ `useReducer` + æ¨¡å—åŒ– reducer slices |
| IPC è§„èŒƒ | æ‰€æœ‰ Tauri è°ƒç”¨é›†ä¸­ `services/tauri.ts`ï¼Œäº‹ä»¶é›†ä¸­ `services/events.ts` |
| è¿­ä»£èŠ‚å¥ | 6 å‘¨ 77 ä¸ªç‰ˆæœ¬ï¼Œ2600+ starï¼Œ70 contributors |

#### å†³ç­–ç»“è®º

| é¡¹ç›® | ç»“è®º | è¯´æ˜ |
| --- | --- | --- |
| è®¸å¯è¯ | å¯å¤ç”¨ | CodexMonitor ä¸º MITï¼Œå¯åœ¨ä¿ç•™ç‰ˆæƒä¸è®¸å¯è¯å£°æ˜å‰æä¸‹å¤ç”¨ |
| æ˜¯å¦ç›´æ¥ Fork å…¨é‡æ”¹é€  | ä¸å»ºè®® | CodexMonitor æ·±åº¦ç»‘å®š `codex app-server`ï¼Œç›´æ¥æ”¹æˆ iFlow æˆæœ¬é«˜ã€é£é™©é«˜ |
| æ¨èç­–ç•¥ | æ¨¡å—å€Ÿé‰´ + æ¸è¿›è¿ç§» | ä¿æŒå½“å‰ iFlow MVP ä¸»é“¾è·¯ï¼ŒæŒ‰æ¨¡å—å¸æ”¶æˆç†Ÿå·¥ç¨‹å®è·µ |
| iFlow å·®å¼‚åŒ–æ–¹å‘ | å¤š Agent æ”¯æŒ | CodexMonitor ä»…æ”¯æŒ Codexï¼ŒiFlow æ”¯æŒ iFlow/Claude/Codex å¤šç§ Agent æ˜¯æ ¸å¿ƒå·®å¼‚ç‚¹ |

#### å¯å¤ç”¨æ¨¡å—æ¸…å•ï¼ˆCodexMonitor -> iFlowï¼‰

| ä¼˜å…ˆçº§ | å¯å€Ÿé‰´æ¨¡å— | å‚è€ƒæ¥æºï¼ˆCodexMonitorï¼‰ | ç°çŠ¶è½ç‚¹ | å…·ä½“åŠ¨ä½œ |
| --- | --- | --- | --- | --- |
| P0 | åç«¯ Shared Core åˆ†å±‚ | `src-tauri/src/shared/` é¢†åŸŸé€»è¾‘ + è–„é€‚é…å±‚ | `iflow_adapter.rs` ä½“é‡è¾ƒå¤§ | æŒ‰èŒè´£æ‹†åˆ†è¿æ¥ã€åè®®ã€ä¼šè¯ã€äº‹ä»¶æ¨¡å—ï¼Œä¿æŒè¡Œä¸ºä¸å˜ |
| P0 | å‰ç«¯ IPC ç»Ÿä¸€å°è£… | `services/tauri.ts` å•å…¥å£ + `services/events.ts` äº‹ä»¶ä¸­å¿ƒ | `src/main.ts` ç›´æ¥è°ƒç”¨ `invoke/listen` | æŠ½ç¦» `src/services/tauri.ts` ä¸ `src/services/events.ts` |
| P0 | ä¼šè¯çŠ¶æ€ Reducer æ¨¡å¼ | `useThreadsReducer` + æ¨¡å—åŒ– reducer slices | çŠ¶æ€åˆ†æ•£åœ¨ `src/main.ts` å¤šä¸ª map | å¼•å…¥ `useReducer` + slice æ‹†åˆ†ï¼Œä¸»å…¥å£åªä¿ç•™ç¼–æ’ |
| P0 | Feature-Sliced å‰ç«¯ç›®å½• | æŒ‰é¢†åŸŸæ‹† `features/{threads,composer,settings}/` | æ‰€æœ‰é€»è¾‘å †åœ¨ `main.ts` | æŒ‰åŠŸèƒ½åŸŸæ‹†ç›®å½•ï¼Œå„å« components + hooks |
| P1 | Workspace ç”Ÿå‘½å‘¨æœŸæ¨¡å‹ | `workspaces_core.rs` ç‹¬ç«‹é¢†åŸŸæ¨¡å— | Agent ä¸ workspace å½“å‰è€¦åˆè¾ƒç´§ | å¢åŠ  workspace å®ä½“å±‚ï¼Œä¸ºå¤šå·¥ä½œåŒºå¹¶å‘åšå‡†å¤‡ |
| P2 | Git/GitHub é¢æ¿èƒ½åŠ› | `git_ui_core.rs` + å‰ç«¯ Git é¢æ¿ | å½“å‰æœªé‡ç‚¹å»ºè®¾ | iFlow ä¸»é“¾è·¯ç¨³å®šåå†è¯„ä¼°å¼•å…¥ |
| P2 | è¿œç¨‹ daemon / iOS | TCP JSON-RPC daemon + protocol parity | å½“å‰æœ¬åœ°ä¼˜å…ˆ | MVP é˜¶æ®µæš‚ç¼“ï¼Œé¿å…è¿‡æ—©å¤æ‚åŒ– |

#### ä¸¤å‘¨è½åœ°è·¯çº¿å›¾

| å‘¨æ¬¡ | ç›®æ ‡ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
| --- | --- | --- | --- |
| ç¬¬ 1 å‘¨ | ç¨³å®šå†…æ ¸ï¼Œé™ä½è€¦åˆ | 1) ACP åç«¯æ‹†åˆ†<br>2) å‰ç«¯ IPC/äº‹ä»¶å±‚æŠ½ç¦»<br>3) ä¼šè¯çŠ¶æ€é›†ä¸­ | ä¸å›é€€ï¼šè¿æ¥ã€å‘é€ã€æµå¼ã€tool-callã€task-finish å‡å¯ç”¨ |
| ç¬¬ 2 å‘¨ | è¡¥é½å·¥ç¨‹åŒ–èƒ½åŠ› | 1) workspace æŠ½è±¡<br>2) é”™è¯¯æ¢å¤ä¸é‡è¿å¼ºåŒ–<br>3) æµ‹è¯•è¡¥å…¨ | `cargo check` ä¸ `cargo test` é€šè¿‡ï¼Œæ ¸å¿ƒæ‰‹å·¥å›å½’é€šè¿‡ |

#### ç«‹å³æ‰§è¡Œï¼ˆP0ï¼‰

| é¡ºåº | ä»»åŠ¡ | æ–‡ä»¶ | å‚è€ƒæ¨¡å¼ |
| --- | --- | --- | --- |
| 1 | æ‹†åˆ† `iflow_adapter`ï¼ˆç­‰ä»·é‡æ„ï¼Œé›¶è¡Œä¸ºå˜åŒ–ï¼‰ | `src-tauri/src/agents/iflow_adapter.rs` | CodexMonitor `shared/` core æ¨¡å¼ |
| 2 | å‰ç«¯ Feature-Sliced ç›®å½•æ‹†åˆ† | `src/main.ts` â†’ `src/features/` | CodexMonitor `features/{threads,composer}/` |
| 3 | è¿ç§» Tauri è°ƒç”¨åˆ°æœåŠ¡å±‚ | `src/services/tauri.ts`ï¼ˆæ–°å¢ï¼‰ | CodexMonitor `services/tauri.ts` å•å…¥å£ |
| 4 | é›†ä¸­äº‹ä»¶åˆ†å‘ä¸è®¢é˜… | `src/services/events.ts`ï¼ˆæ–°å¢ï¼‰ | CodexMonitor `services/events.ts` äº‹ä»¶ä¸­å¿ƒ |
| 5 | ä¼šè¯çŠ¶æ€ reducer åŒ– | `src/features/threads/` | CodexMonitor `useThreadsReducer` + slices |

---

## å‚è€ƒèµ„æº

- [ACP Protocol Specification](https://github.com/...)
- [Tauri Documentation](https://tauri.app/)
- [OpenWork](https://github.com/...)
- [Mossx](https://github.com/...)
- [Codexia](https://github.com/...)

---

*æœ€åæ›´æ–°: 2026-02-24*
